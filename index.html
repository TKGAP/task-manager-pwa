<!DOCTYPE html>
<html lang="ja">
<head>
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0052cc">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>付箋付きタスク管理アプリ（年移動付きカレンダー）</title>
<style>
  /* 省略: 以前のスタイルそのまま使ってね */

  header {
    background:#0052cc;
    color:#fff;
    padding:1rem;
    text-align:center;
    font-size:1.3rem;
  }
  main {
    max-width: 900px;
    margin: auto;
    padding: 1rem;
  }
  /* タブ切替ボタン */
  .tabs {
    display:flex;
    justify-content:center;
    margin-bottom: 1rem;
  }
  .tab-btn {
    padding: 0.5rem 1.5rem;
    margin:0 0.3rem;
    border:none;
    background:#ccc;
    border-radius:4px;
    cursor:pointer;
    font-weight:bold;
  }
  .tab-btn.active {
    background:#0052cc;
    color:#fff;
  }

  /* カレンダー年移動ボタンエリア */
  #calendarNav {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 0.5rem;
    gap: 1rem;
  }
  #calendarNav button {
    background:#0052cc;
    color:#fff;
    border:none;
    padding:0.3rem 0.8rem;
    border-radius:6px;
    cursor:pointer;
    font-weight: bold;
  }
  #calendarNav .year-month-display {
    font-weight: bold;
    font-size: 1.2rem;
    min-width: 140px;
    text-align: center;
  }

  /* 省略：カレンダーのスタイルは前のままでOK */

</style>
</head>
<body>
<header>付箋付きタスク管理アプリ</header>
<main>
  <div class="tabs">
    <button class="tab-btn active" data-view="list">リスト表示</button>
    <button class="tab-btn" data-view="calendar">カレンダー表示</button>
  </div>

  <section id="listView">
    <button id="addTaskBtn">＋ タスク追加</button>
    <div id="taskList"></div>
  </section>
 <section id="calendarView" style="display:none;">
  <div id="calendarNav">
    <button id="prevYearBtn">« 1年戻る</button>
    <button id="prevMonthBtn">‹ 1ヶ月戻る</button>
    <div class="year-month-display" id="yearMonthDisplay"></div>
    <button id="nextMonthBtn">› 1ヶ月進む</button>
    <button id="nextYearBtn">» 1年進む</button>
  </div>
  <div id="calendar"></div>
</section> 
</main>

<script>
(() => {
  let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
  let currentYearMonth = new Date(); // 表示する年月（Dateオブジェクト）

  // UI 要素取得
  const tabs = document.querySelectorAll(".tab-btn");
  const listView = document.getElementById("listView");
  const calendarView = document.getElementById("calendarView");
  const taskList = document.getElementById("taskList");
  const calendarDiv = document.getElementById("calendar");
  const yearMonthDisplay = document.getElementById("yearMonthDisplay");
  const prevYearBtn = document.getElementById("prevYearBtn");
  const nextYearBtn = document.getElementById("nextYearBtn");
  const addTaskBtn = document.getElementById("addTaskBtn");

  // タブ切替処理
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(b => b.classList.remove("active"));
      tab.classList.add("active");
      if (tab.dataset.view === "list") {
        listView.style.display = "";
        calendarView.style.display = "none";
        renderTasks();
      } else {
        listView.style.display = "none";
        calendarView.style.display = "";
        renderCalendar();
      }
    });
  });

  // 年月表示更新
  function updateYearMonthDisplay() {
    yearMonthDisplay.textContent = `${currentYearMonth.getFullYear()}年 ${currentYearMonth.getMonth() + 1}月`;
  }
prevYearBtn.addEventListener("click", () => {
  currentYearMonth.setFullYear(currentYearMonth.getFullYear() - 1);
  renderCalendar();
});
nextYearBtn.addEventListener("click", () => {
  currentYearMonth.setFullYear(currentYearMonth.getFullYear() + 1);
  renderCalendar();
});
prevMonthBtn.addEventListener("click", () => {
  currentYearMonth.setMonth(currentYearMonth.getMonth() - 1);
  renderCalendar();
});
nextMonthBtn.addEventListener("click", () => {
  currentYearMonth.setMonth(currentYearMonth.getMonth() + 1);
  renderCalendar();
});

  // タスク描画（リスト）
  function renderTasks() {
    taskList.innerHTML = "";
    tasks.forEach((task, i) => {
      const div = document.createElement("div");
      div.textContent = task.title;
      taskList.appendChild(div);
    });
  }

  // カレンダー描画
  function renderCalendar() {
    updateYearMonthDisplay();

    calendarDiv.innerHTML = "";
    const year = currentYearMonth.getFullYear();
    const month = currentYearMonth.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startWeekDay = firstDay.getDay();
    const totalDays = lastDay.getDate();

    // カレンダーテーブル生成
    const table = document.createElement("table");
    table.style.borderCollapse = "collapse";
    table.style.width = "100%";

    // ヘッダー曜日
    const thead = document.createElement("thead");
    const trHead = document.createElement("tr");
    ["日", "月", "火", "水", "木", "金", "土"].forEach(d => {
      const th = document.createElement("th");
      th.textContent = d;
      th.style.border = "1px solid #ccc";
      th.style.backgroundColor = "#0052cc";
      th.style.color = "#fff";
      th.style.padding = "4px";
      trHead.appendChild(th);
    });
    thead.appendChild(trHead);
    table.appendChild(thead);

    // 日付部分
    const tbody = document.createElement("tbody");
    let dayCount = 1;
    for (let i = 0; i < 6; i++) {
      const tr = document.createElement("tr");
      for (let j = 0; j < 7; j++) {
        const td = document.createElement("td");
        td.style.border = "1px solid #ccc";
        td.style.height = "80px";
        td.style.verticalAlign = "top";
        td.style.padding = "2px 4px";

        if (i === 0 && j < startWeekDay) {
          td.textContent = "";
        } else if (dayCount > totalDays) {
          td.textContent = "";
        } else {
          const dateDiv = document.createElement("div");
          dateDiv.style.fontWeight = "bold";
          dateDiv.style.fontSize = "0.9rem";
          dateDiv.style.marginBottom = "3px";
          dateDiv.textContent = dayCount;
          td.appendChild(dateDiv);

          // その日のタスク表示
          const dayStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(dayCount).padStart(2, "0")}`;
          tasks.forEach(task => {
            if (task.due === dayStr) {
              const taskDiv = document.createElement("div");
              taskDiv.textContent = task.title;
              taskDiv.style.backgroundColor = "#e0e7ff";
              taskDiv.style.borderRadius = "6px";
              taskDiv.style.margin = "2px 0";
              taskDiv.style.padding = "2px 4px";
              taskDiv.style.fontSize = "0.75rem";
              taskDiv.style.whiteSpace = "nowrap";
              taskDiv.style.overflow = "hidden";
              taskDiv.style.textOverflow = "ellipsis";
              td.appendChild(taskDiv);
            }
          });

          dayCount++;
        }
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    }
    table.appendChild(tbody);

    calendarDiv.appendChild(table);
  }

// 初期表示
  renderTasks();

  // タスク追加はまだ未実装なのでボタンは無効化中
  addTaskBtn.disabled = true;

  // ←この中に serviceWorker のコードを入れる！
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }

})();  <!-- ここで即時関数が終わる -->
</script>

</body>
</html>
